# ИНСТРУКЦИЯ: Как собрать classes.dex и libvis.so на вашем компьютере

## Текущая ситуация

В среде нет установленного Android SDK и NDK, которые необходимы для компиляции. Вам нужно выполнить сборку на своём компьютере.

## Что уже подготовлено

✅ Исходный код Java - готов к сборке
✅ Исходный код C++ - готов к сборке
✅ Название библиотеки изменено на "vis"
✅ Скрипты автоматизации - созданы

## Требуемые инструменты

### 1. Java JDK
Установлен Java JDK 17 (или новее), который включает `javac`

**Проверка:**
```bash
java -version
javac -version
```

### 2. Android SDK Command Line Tools
Скачайте с: https://developer.android.com/studio#command-tools

**Установка:**
```bash
# Создайте директорию для SDK
mkdir -p ~/android-sdk
cd ~/android-sdk

# Скачайте и распакуйте Command Line Tools
# Linux:
wget https://dl.google.com/android/repository/commandlinetools-linux-9477386_latest.zip
unzip commandlinetools-linux-9477386_latest.zip
mkdir -p cmdline-tools/latest
mv cmdline-tools/* cmdline-tools/latest/

# Настройте переменные окружения
export ANDROID_HOME=~/android-sdk
export PATH=$PATH:$ANDROID_HOME/cmdline-tools/latest/bin:$ANDROID_HOME/platform-tools
```

### 3. Android NDK
Установите через sdkmanager:
```bash
sdkmanager "ndk;25.2.9519653"
export ANDROID_NDK_HOME=$ANDROID_HOME/ndk/25.2.9519653
```

### 4. Android Platform и Build Tools
```bash
sdkmanager "platform-tools"
sdkmanager "platforms;android-30"
sdkmanager "build-tools;30.0.3"
```

### 5. Добавьте в ~/.bashrc
```bash
echo 'export ANDROID_HOME=~/android-sdk' >> ~/.bashrc
echo 'export ANDROID_NDK_HOME=~/android-sdk/ndk/25.2.9519653' >> ~/.bashrc
echo 'export PATH=$PATH:$ANDROID_HOME/cmdline-tools/latest/bin:$ANDROID_HOME/platform-tools' >> ~/.bashrc
source ~/.bashrc
```

---

## Пошаговая сборка

### Шаг 1: Перейдите в директорию проекта
```bash
cd /path/to/your/project/mod_menu_rootless
```

### Шаг 2: Проверьте переменные окружения
```bash
echo $ANDROID_HOME
echo $ANDROID_NDK_HOME
```

Если они пустые, установите их как описано выше.

### Шаг 3: Запустите автоматическую сборку
```bash
./build_and_inject_all.sh
```

Этот скрипт автоматически:
- Скомпилирует Java классы
- Создаст classes.dex
- Скомпилирует C++ код в libvis.so
- Внедрит файлы в распакованный APK

---

## Ручная сборка (по шагам)

Если автоматический скрипт не работает, выполните вручную:

### Шаг 1: Сборка native библиотеки (libvis.so)
```bash
cd mod_menu_rootless/jni

$ANDROID_NDK_HOME/ndk-build NDK_PROJECT_PATH=. APP_BUILD_SCRIPT=Android.mk \
    NDK_DEBUG=0 \
    APP_OPTIM=release \
    -j$(nproc)

cd ..
```

После успешной сборки файлы будут в:
- `mod_menu_rootless/libs/arm64-v8a/libvis.so`
- `mod_menu_rootless/libs/armeabi-v7a/libvis.so`

### Шаг 2: Компиляция Java классов
```bash
cd mod_menu_rootless

# Создайте директорию для компиляции
mkdir -p build/classes

# Скомпилируйте Java файлы
javac -d build/classes \
    -source 1.8 -target 1.8 \
    -bootclasspath $ANDROID_HOME/platforms/android-30/android.jar \
    java/com/modmenu/loader/*.java
```

### Шаг 3: Создание classes.dex
```bash
# Найдите d8 инструмент
D8_TOOL=$ANDROID_HOME/build-tools/30.0.3/d8

# Создайте DEX файл
$D8_TOOL --lib $ANDROID_HOME/platforms/android-30/android.jar \
    --release \
    --output build/ \
    build/classes/com/modmenu/loader/*.class
```

После этого у вас будет:
- `mod_menu_rootless/build/classes.dex`

### Шаг 4: Внедрение файлов в APK
```bash
# Копируйте classes.dex
mkdir -p ../assets
cp build/classes.dex ../assets/

# Копируйте native библиотеки
mkdir -p ../lib/arm64-v8a
cp libs/arm64-v8a/libvis.so ../lib/arm64-v8a/

mkdir -p ../lib/armeabi-v7a
cp libs/armeabi-v7a/libvis.so ../lib/armeabi-v7a/
```

---

## Пересборка APK

После внедрения файлов вам нужно пересобрать APK:

### Способ 1: Использование apktool
```bash
cd /path/to/your/project

# Пересоберите APK
apktool b . -o standoff2_modded.apk

# Создайте debug keystore (если нет)
keytool -genkey -v -keystore debug.keystore -alias androiddebugkey \
    -keyalg RSA -keysize 2048 -validity 10000 \
    -storepass android -keypass android \
    -dname "CN=Android Debug,O=Android,C=US"

# Подпишите APK
apksigner sign --ks debug.keystore --ks-pass pass:android \
    --key-pass pass:android standoff2_modded.apk

# Или используя jarsigner
jarsigner -sigalg SHA1withRSA -digestalg SHA1 \
    -keystore debug.keystore -storepass android \
    -keypass android standoff2_modded.apk androiddebugkey

# Установите на устройство
adb install -r standoff2_modded.apk
```

### Способ 2: Простая упаковка как ZIP
```bash
cd /path/to/your/project

# Упакуйте все файлы в APK
zip -r standoff2_modded.apk *

# Подпишите
apksigner sign --ks debug.keystore --ks-pass pass:android standoff2_modded.apk
```

---

## Важно: Интеграция кода

После пересборки APK нужно добавить вызовы загрузчика:

1. Откройте APK с помощью apktool:
```bash
apktool d standoff2_modded.apk -o apk_decoded
```

2. Найдите главный Application класс:
```
apk_decoded/smali/com/yourpackage/YourApplication.smali
```

3. В методе `onCreate()` после строки `invoke-super` добавьте:
```smali
invoke-static {p0}, Lcom/modmenu/loader/DexInjector;->inject(Landroid/content/Context;)V
invoke-static {p0}, Lcom/modmenu/loader/ModMenuLoader;->inject(Landroid/app/Application;)V
```

4. Пересоберите APK:
```bash
apktool b apk_decoded -o standoff2_modded.apk
```

5. Проверьте AndroidManifest.xml на наличие разрешений:
```xml
<uses-permission android:name="android.permission.SYSTEM_ALERT_WINDOW"/>
<uses-permission android:name="android.permission.INTERNET"/>
```

---

## Проверка результатов

### Проверьте наличие файлов:
```bash
ls -lh /path/to/your/project/assets/classes.dex
ls -lh /path/to/your/project/lib/arm64-v8a/libvis.so
ls -lh /path/to/your/project/lib/armeabi-v7a/libvis.so
```

### Проверьте APK:
```bash
# Посмотрите содержимое APK
unzip -l standoff2_modded.apk | grep -E "(classes.dex|libvis.so)"

# Проверьте подпись
apksigner verify -v standoff2_modded.apk
```

---

## Возможные проблемы

### 1. Ошибка: "d8: command not found"
Решение: Установите build-tools через sdkmanager:
```bash
sdkmanager "build-tools;30.0.3"
```

### 2. Ошибка: "ndk-build: command not found"
Решение: Установите ANDROID_NDK_HOME:
```bash
sdkmanager "ndk;25.2.9519653"
export ANDROID_NDK_HOME=$ANDROID_HOME/ndk/25.2.9519653
```

### 3. Ошибка компиляции Java
Решение: Убедитесь, что используете Java 8+:
```bash
javac -version
```

### 4. Ошибка при сборке native
Решение: Проверьте наличие необходимых зависимостей:
```bash
# Ubuntu/Debian
sudo apt-get install build-essential cmake

# macOS
xcode-select --install
```

---

## Резюме

После выполнения всех шагов у вас будет:

1. **classes.dex** - Java мод меню
2. **libvis.so** - Native модуль с ESP, Aimbot и защитой
3. **standoff2_modded.apk** - Модифицированный APK

Установите APK на устройство и разрешите наложение поверх окон в настройках.

---

## Дополнительные ресурсы

- Android SDK: https://developer.android.com/studio
- Android NDK: https://developer.android.com/ndk
- apktool: https://ibotpeaches.github.io/Apktool/

Если у вас возникнут вопросы, проверьте также:
- `mod_menu_rootless/README_VIS.md` - Основная инструкция
- `mod_menu_rootless/SETUP_GUIDE.md` - Установка SDK/NDK
- `ИТОГОВАЯ_ИНСТРУКЦИЯ.md` - Общее описание
